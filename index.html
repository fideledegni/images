<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Décor EEIA 2022</title>
    <!-- <link rel="icon" type="image/jpg" href="media/logo.jpg"/> -->

    <!-- Barlow Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Barlow:300,400,500,700&display=swap" />
    <!-- The Nautigal Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=The+Nautigal:300,400,500,700&display=swap" />

    <link rel="stylesheet" href="src/styles/reset.css" />
    <link rel="stylesheet" href="src/styles/main.css" />
  </head>

  <body>
    <header class="hidden-print">
      <noscript>You need to enable JavaScript to run this app.</noscript>
      <script type='module'>
        //import the library to talk to imagemagick
        import * as Magick from 'https://knicknic.github.io/wasm-imagemagick/magickApi.js';
    
        // various html elements
        let rotatedImage = document.getElementById('rotatedImage');

        // Fetch the image to rotate, and call image magick
        let doMagickCall = async function () {
          let fetchedSourceImage = await fetch("src/images/chateau.JPG");
          let arrayBuffer = await fetchedSourceImage.arrayBuffer();
          let sourceBytes = new Uint8Array(arrayBuffer);

          // calling image magick with one source image, and command to rotate & resize image
          const files = [{ 'name': 'srcFile.png', 'content': sourceBytes }];
          const command = ["convert", "srcFile.png", "-rotate", "90", "-resize", "200%", "out.png"];
          let processedFiles = await Magick.Call(files, command);

          // response can be multiple files (example split)
          // here we know we just have one
          let firstOutputImage = processedFiles[0]
          rotatedImage.src = URL.createObjectURL(firstOutputImage['blob'])
          console.log("created image " + firstOutputImage['name'])
        };
        doMagickCall();
      </script>
    </header>

    <main>
      <nav>
        Décor EEIA 2022
      </nav>

      <div id="root">
        Test
      </div>

      <br/>
      <p>Source image: </p>
      <img id="srcImage" src="src/images/chateau.JPG" height="400px">
      <br/>
      <br/>
      <p>Rotated and enlarged image: </p>
      <img id="rotatedImage">
    </main>
  </body>

  <footer>
    <div>
      &copy; Fidèle Degni - Tous droits réservés<br/>
      Juillet 2022
    </div>
  </footer>
</html>